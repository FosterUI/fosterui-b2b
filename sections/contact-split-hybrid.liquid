{{ 'section-contact-split-hybrid.css' | asset_url | stylesheet_tag }}

<div class="contact-split-section" id="contact">
  <div class="page-width">
    <div class="contact-grid">
      
      <div class="contact-info">
        <h2 class="h2">{{ section.settings.title }}</h2>
        <div class="rte">
          {{ section.settings.text }}
        </div>
      </div>

      <div class="contact-form-container">
        <div class="contact-form-box">
          
          {% if section.settings.use_hubspot %}
            <div class="hubspot-form-embed">
              
              <div class="form-tabs-pill-container">
                <div class="tab-link active" data-form="roadmap">Book the Roadmap</div>
                <div class="tab-link" data-form="audit">Request a Video Audit</div>
              </div>

              <div id="roadmap-form" class="form-content active">
                <h3>{{ section.settings.roadmap_title }}</h3>
                <p>{{ section.settings.roadmap_desc }}</p>
                
                <div id="hubspot-roadmap-container"></div>
              </div>

              <div id="audit-form" class="form-content">
                <h3>{{ section.settings.audit_title }}</h3>
                <p>{{ section.settings.audit_desc }}</p>
                
                <div id="hubspot-audit-container"></div>
              </div>
            </div>
          
          {% else %}
            <div class="fallback-form">
             {% form 'contact' %}
               
               {% if form.posted_successfully? %}
                <p class="form-success form-status-list form__message" tabindex="-1" autofocus>Thanks for contacting us. We'll get back to you as soon as possible.</p>
               {% endif %}

               <button type="submit" class="btn-brand btn-brand-primary">Submit Request â†’</button>
             {% endform %}
            </div>
           {% endif %}

        </div>
      </div>

    </div>
  </div>
</div>

<script>
  // 1. Tab Switching Logic
  document.addEventListener('DOMContentLoaded', function() {
    const tabs = document.querySelectorAll('.contact-form-box .tab-link');
    const forms = document.querySelectorAll('.contact-form-box .form-content');

    tabs.forEach(tab => {
      tab.addEventListener('click', function() {
        const formName = this.getAttribute('data-form');

        // Hide all forms and deactivate all tabs
        forms.forEach(form => form.classList.remove('active'));
        tabs.forEach(t => t.classList.remove('active'));

        // Show the selected form and activate its tab
        document.getElementById(formName + '-form').classList.add('active');
        this.classList.add('active');
      });
    });
  });

  // 2. HubSpot Form Initialization (Robust Loading Method)
  // Dynamically load the HubSpot script once and initialize forms on load.
  (function() {
    // Only run if HubSpot is enabled in settings
    if ({{ section.settings.use_hubspot }}) {
        const script = document.createElement('script');
        script.src = "//js.hsforms.net/forms/embed/v2.js";
        script.charset = "utf-8";
        script.type = "text/javascript";
        document.body.appendChild(script);
    
        script.onload = function() {
          if (window.hbspt) {
            // Initialize Roadmap Form
            hbspt.forms.create({
              region: "na1",
              portalId: "40164173", // Your Portal ID
              formId: "9b74bbf1-97b6-4e1a-a5b5-cee87094b536", // Roadmap Form ID
              target: '#hubspot-roadmap-container'
            });
    
            // Initialize Audit Form
            hbspt.forms.create({
              region: "na1",
              portalId: "40164173", // Your Portal ID
              formId: "25a94b25-c81c-4d24-9cc4-c8a0c08c2917", // Audit Form ID
              target: '#hubspot-audit-container'
            });
          }
        };
    }
  })();
</script>

{% schema %}
{
  "name": "B2B Contact Split -Hybrid",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Pitch (Left Side)"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Heading",
      "default": "Ready to Transform Your Wholesale Channel?"
    },
    {
      "type": "richtext",
      "id": "text",
      "label": "Text",
      "default": "<p>Don't let manual processes stunt your growth.</p><h3>What You Get in 5 Days:</h3><ul><li>A clear 90-Day Implementation Plan</li><li>A tailored Revenue Impact Model</li></ul>"
    },
    {
      "type": "header",
      "content": "Form Settings (Right Side)"
    },
    {
      "type": "checkbox",
      "id": "use_hubspot",
      "label": "Use HubSpot Tabbed Forms",
      "default": true
    },
    {
      "type": "text",
      "id": "roadmap_title",
      "label": "Roadmap Tab Title",
      "default": "The Essential First Step"
    },
    {
      "type": "textarea",
      "id": "roadmap_desc",
      "label": "Roadmap Tab Description",
      "default": "Fill out the form below to request a booking for the $1,950 B2B & AI Opportunity Roadmap. I'll personally review it and be in touch within one business day."
    },
    {
      "type": "text",
      "id": "audit_title",
      "label": "Audit Tab Title",
      "default": "Get a Quick Overview First"
    },
    {
      "type": "textarea",
      "id": "audit_desc",
      "label": "Audit Tab Description",
      "default": "Fill out the form below, and I will personally record a 5-minute Loom video highlighting specific bottlenecks in your current setup. Please allow 2-3 business days."
    }
  ],
  "presets": [
    {
      "name": "B2B Contact Split (Hybrid)"
    }
  ]
}
{% endschema %}