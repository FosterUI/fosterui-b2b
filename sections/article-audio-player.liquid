{{ 'section-blog-layout.css' | asset_url | stylesheet_tag }}

{% comment %} Check if the metafield 'custom.audio_overview' has a value {% endcomment %}
{% assign audio_file = article.metafields.custom.audio_overview.value %}

{% if audio_file %}
  <div class="article-container article-section-spacing">
    <div class="article-audio-player">
      <label class="article-audio-player__label" for="audio-player-{{ article.id }}">
        {{- section.settings.audio_player_label -}}
      </label>

      {% comment %} Get the URL using the standard file_url filter {% endcomment %}
      {% assign audio_url = audio_file | file_url %}

      {% comment %} Render the native HTML5 audio player. M4A uses audio/mp4 type. {% endcomment %}
      <audio id="audio-player-{{ article.id }}" controls preload="metadata">
        <source src="{{ audio_url }}" type="audio/mp4">
        Your browser does not support the audio element.
      </audio>
    </div>
  </div>
{% endif %}

{% schema %}
{
  "name": "Audio Player",
  "class": "article-page-background",
  "settings": [
    {
      "type": "paragraph",
      "content": "The audio player automatically appears if the 'Article Audio Overview' metafield (custom.audio_overview) is populated on the blog post."
    },
    {
      "type": "text",
      "id": "audio_player_label",
      "label": "Audio Player Label",
      "default": "Listen to the Audio Overview:"
    }
  ],
  "presets": [
    {
      "name": "Audio Player"
    }
  ]
}
{% endschema %}
