{{ 'section-blog-layout.css' | asset_url | stylesheet_tag }}

{% comment %} Check if the metafield 'custom.audio_overview' has a value {% endcomment %}
{% assign audio_file = article.metafields.custom.audio_overview.value %}

{% if audio_file %}
  <div class="article-container article-section-spacing">
    <div class="article-audio-player">
      <label class="article-audio-player__label" for="audio-player-{{ article.id }}">
        {{- section.settings.audio_player_label -}}
      </label>

      {% comment %} Robust URL resolution: Try accessing .url property first (more reliable for File references), then fallback to file_url filter {% endcomment %}
      {% assign audio_url = audio_file.url | default: audio_file | file_url %}

      {% comment %} Render the native HTML5 audio player. M4A uses audio/mp4 type. {% endcomment %}
      {% if audio_url != blank %}
        <audio id="audio-player-{{ article.id }}" controls preload="metadata">
          {% comment %} Using audio/mp4 which is the standard MIME type for M4A files {% endcomment %}
          <source src="{{ audio_url }}" type="audio/mp4">
          Your browser does not support the audio element.
        </audio>
      {% else %}
        {% comment %} Display a fallback message if the URL cannot be generated {% endcomment %}
        <div style="padding: 1rem; background: #fee; border: 1px solid #fcc; border-radius: 4px; color: #c33;">
          <strong>Developer Note:</strong> Audio file reference found, but URL could not be generated.
        </div>
      {% endif %}
    </div>
  </div>
{% endif %}

{% schema %}
{
  "name": "Audio Player",
  "class": "article-page-background",
  "settings": [
    {
      "type": "paragraph",
      "content": "The audio player automatically appears if the 'Article Audio Overview' metafield (custom.audio_overview) is populated on the blog post."
    },
    {
      "type": "text",
      "id": "audio_player_label",
      "label": "Audio Player Label",
      "default": "Listen to the Audio Overview:"
    }
  ],
  "presets": [
    {
      "name": "Audio Player"
    }
  ]
}
{% endschema %}
